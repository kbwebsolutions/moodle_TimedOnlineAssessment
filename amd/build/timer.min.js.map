{"version":3,"sources":["../src/timer.js"],"names":["init","endTime","assignmentId","instanceId","isSubmitted","makeTimer","now","Date","parse","timeLeft","updateClock","window","onbeforeunload","responseText","document","getElementById","value","doSubmit","days","Math","floor","hours","minutes","seconds","$","when","Str","get_string","done","localisedString","innerHTML","ajax","url","config","wwwroot","type","dataType","data","responsetext","assignmentid","complete","location","setInterval"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n*\n*\n* @package assignsubmission_timedonline\n* @author  Marcus Green and Steve Anatai\n* @copyright 2021 Titus {@link http://www.tituslearning.com}\n* @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n*/\nimport * as Str from 'core/str';\nimport * as config from 'core/config';\nimport $ from 'jquery';\nexport const init = (endTime, assignmentId, instanceId) => {\n    var isSubmitted = false;\n    function makeTimer(endTime) {\n        debugger;\n\n        var endTime = endTime;\n        var now = new Date();\n\n        var now = (Date.parse(now) / 1000);\n        var timeLeft = endTime - now;\n\n        if (timeLeft < 0 && (!isSubmitted)) {\n            updateClock(0, 0);\n            window.onbeforeunload = null;\n            var responseText = document.getElementById(\"id_responsetext_editor\").value;\n            isSubmitted = true;\n            doSubmit(assignmentId, responseText);\n            return;\n        }\n        if (isSubmitted) {\n            return;\n        }\n        // Days and hours are not used at the moment.\n        var days = Math.floor(timeLeft / 86400);\n        var hours = Math.floor((timeLeft - (days * 86400)) / 3600);\n\n        var minutes = Math.floor(timeLeft / 60);\n        var seconds = Math.floor((timeLeft - (minutes * 60)));\n\n        if (hours < \"10\") {\n            hours = \"0\" + hours;\n        }\n        if (minutes < \"10\") {\n            minutes = \"0\" + minutes;\n        }\n        if (seconds < \"10\") {\n            seconds = \"0\" + seconds;\n        }\n        updateClock(minutes, seconds);\n    }\n    function updateClock(minutes, seconds) {\n        $.when(Str.get_string('minutes', 'assignsubmission_timedonline')).done(function (localisedString) {\n            document.getElementById(\"minutes\").innerHTML = minutes + \"<span>\" + localisedString + \"</span>\";\n        });\n        $.when(Str.get_string('seconds', 'assignsubmission_timedonline')).done(function (localisedString) {\n            document.getElementById(\"seconds\").innerHTML = seconds + \"<span>\" + localisedString + \"</span>\";\n        });\n\n    }\n    function doSubmit(assignmentId, responseText) {\n        $.ajax({\n            url: config.wwwroot + \"/mod/assign/submission/timedonline/autosave.php\",\n            type: \"post\",\n            dataType: \"json\",\n            data: {\n                responsetext: responseText,\n                assignmentid: assignmentId\n            },\n            complete: function () {\n                window.location = config.wwwroot + \"/mod/assign/view.php?id=\" + instanceId;\n            }\n        });\n    }\n    setInterval(function () { makeTimer(endTime, assignmentId, instanceId); }, 0);\n};"],"file":"timer.min.js"}